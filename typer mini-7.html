<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Typer Shark Deluxe (Standalone)</title>
  <style>
    :root{--bg:#a7f3d0;--sand:#fef3c7;--shark:#2b6cb0;--hud:#000}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .container{box-sizing:border-box;padding:16px;height:100%;display:flex;flex-direction:column;gap:8px}
    .topbar{display:flex;justify-content:space-between;gap:12px;color:#111}
    .board{flex:1;border-radius:8px;border:1px solid rgba(0,0,0,0.06);position:relative;overflow:hidden;background:var(--bg)}
    canvas{display:block;width:100%;height:100%}
    .controls{display:flex;justify-content:space-between;align-items:center;gap:12px}
    button{padding:8px 12px;border-radius:6px;border:0;background:#0ea5e9;color:white;cursor:pointer}
    button.secondary{background:#10b981}
    .note{font-size:12px;color:#444}

  </style>
</head>
<body>
  <div class="container">
    <div class="topbar">
      <div>Score: <span id="hud-score">0</span></div>
      <div>Lives: <span id="hud-lives">3</span></div>
      <div>Wave: <span id="hud-wave">0</span></div>
    </div>

    <div class="board">
      <canvas id="game-canvas"></canvas>
    </div>

    <div class="controls">
      <div>Input: <span id="hud-input" style="font-family:monospace"> </span></div>
      <div style="display:flex;gap:8px">
        <button id="btn-pause">Pause</button>
        <button id="btn-restart" class="secondary">Restart</button>
      </div>
    </div>

    <div class="note">Petunjuk: Ketik huruf untuk menyelesaikan kata pada badan hiu. Tidak perlu tekan Enter. Hiu muncul bergiliran tiap 1 detik, 1 wave terdiri dari 5 hiu.</div>
  </div>

<script>
// Typer Shark Deluxe - standalone HTML/JS
(function(){
  const canvas = document.getElementById('game-canvas');
  const ctx = canvas.getContext('2d');
  const hudScore = document.getElementById('hud-score');
  const hudLives = document.getElementById('hud-lives');
  const hudWave = document.getElementById('hud-wave');
  const hudInput = document.getElementById('hud-input');
  const btnPause = document.getElementById('btn-pause');
  const btnRestart = document.getElementById('btn-restart');

  // settings
  const ROWS = 2;
  const PER_WAVE = 1; // jumlah ikan per wave
  const DEFAULT_WORDS = [
  "doa","iman","ibadah","taat","sabar","syukur",
  "tawakal","ikhlas","adil","jujur","peduli","ramah",
  "sopan","hormat","empati","santun","kasih","martabat",
  "rukun","damai","cinta","setia","gotong","rela",
  "ikrar","bhinneka","mufakat","arif","rakyat","bijak"
];

  let DPR = window.devicePixelRatio || 1;
  function resizeCanvas(){
    DPR = window.devicePixelRatio || 1;
    const w = canvas.clientWidth || canvas.parentElement.clientWidth;
    const h = canvas.clientHeight || canvas.parentElement.clientHeight;
    canvas.width = Math.floor(w * DPR);
    canvas.height = Math.floor(h * DPR);
    ctx.setTransform(DPR,0,0,DPR,0,0);
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // game state
  let sharks = [];
  let wordsPool = DEFAULT_WORDS.slice();
  let wave = 0;
  let score = 0;
  let lives = 3;
  let running = true;
  let message = 'Ketik kata pada hiu untuk menyelamatkan penyelam!';

  // input state
  let inputBuffer = '';
  let inputTargetId = null;
  let lastKeyTime = 0;
  const INPUT_TIMEOUT = 1200; // ms
  let spawnScheduled = false;

  function pickWord(){
    if(wordsPool.length === 0) wordsPool = DEFAULT_WORDS.slice();
    const i = Math.floor(Math.random() * wordsPool.length);
    return wordsPool.splice(i,1)[0];
  }

  function spawnWave(){
    const width = canvas.width / DPR;
    const height = canvas.height / DPR;
    const paddingRight = 20;
    const rowHeight = Math.floor(height / ROWS);
    let delay = 0;

    for(let i=0;i<PER_WAVE;i++){
      setTimeout(()=>{
        const r = Math.floor(Math.random()*ROWS); // random baris
        const yBase = r*rowHeight + rowHeight/2;
        const word = pickWord();
        const sizeFactor = Math.min(1.4, Math.max(0.8, word.length / 6));
        sharks.push({
          id: `w${wave}-i${i}-${Math.random().toString(36).slice(2,8)}`,
          x: width + paddingRight,
          y: yBase,
          speed: 40 + Math.random()*40,
          word,
          progress: 0,
          dead:false,
          eaten:false,
          sizeFactor
        });
      }, delay);
      delay += 1000; // muncul bergiliran 1 detik
    }
    spawnScheduled = false;
    wave += 1;
    updateHUD();
  }

  function updateHUD(){
    hudScore.textContent = score;
    hudLives.textContent = lives;
    hudWave.textContent = wave;
    hudInput.textContent = inputBuffer;
  }

  // drawing
  function drawDiver(ctx,x,y){
    ctx.save();
    ctx.translate(x,y);
    ctx.fillStyle = '#1e3a8a';
    ctx.beginPath(); ctx.arc(0,-10,10,0,Math.PI*2); ctx.fill();
    ctx.fillRect(-6,0,12,22);
    ctx.restore();
  }

  function drawShark(ctx,s){
    const {x,y,word,progress,dead,sizeFactor} = s;
    ctx.save(); ctx.translate(x,y); ctx.rotate(Math.PI);
    ctx.beginPath(); ctx.ellipse(0,0,60*sizeFactor,22*sizeFactor,0,0,Math.PI*2); ctx.fillStyle = dead ? 'rgba(120,120,120,0.4)' : '#2b6cb0'; ctx.fill();
    ctx.beginPath(); ctx.moveTo(-60*sizeFactor +5,0); ctx.lineTo(-80*sizeFactor,-14*sizeFactor); ctx.lineTo(-80*sizeFactor,14*sizeFactor); ctx.closePath(); ctx.fill();
    ctx.beginPath(); ctx.fillStyle='white'; ctx.arc(22*sizeFactor,-6*sizeFactor,4*sizeFactor,0,Math.PI*2); ctx.fill(); ctx.beginPath(); ctx.fillStyle='black'; ctx.arc(23*sizeFactor,-6*sizeFactor,1.6*sizeFactor,0,Math.PI*2); ctx.fill();

    ctx.rotate(-Math.PI);

    ctx.font = `${12*sizeFactor}px monospace`;
    ctx.textBaseline = 'middle';
    const typedText = word.slice(0,progress);
    const restText = word.slice(progress);
    const typedW = ctx.measureText(typedText).width;
    const restW = ctx.measureText(restText).width;
    const totalW = typedW + restW;
    const padding = 12*sizeFactor;
    const boxW = Math.max(60*sizeFactor, totalW + padding);
    ctx.fillStyle = 'rgba(255,255,255,0.95)';
    ctx.fillRect(-boxW/2, -12*sizeFactor, boxW, 24*sizeFactor);
    ctx.fillStyle = 'green'; ctx.fillText(typedText, -boxW/2 + 6, 0);
    ctx.fillStyle = 'black'; ctx.fillText(restText, -boxW/2 + 6 + typedW, 0);
    ctx.restore();
  }

  // game loop
  let last = performance.now();
  function update(dt){
    if(!running) return;
    const diverX = 80;
    for(let s of sharks){
      if(s.dead || s.eaten) continue;
      s.x -= (s.speed * dt) / 1000;
      if(s.x - 60*s.sizeFactor <= diverX + 10){
        s.eaten = true;
        lives = Math.max(0, lives - 1);
        if(lives === 0) message = 'Game Over â€” semua penyelam tertangkap.'; else message = 'Aduh! Penyelam dimakan hiu.';
        updateHUD();
      }
    }

    // remove off-screen
    sharks = sharks.filter(s => !(s.x < -200));

    if(sharks.length === 0 && !spawnScheduled && running && lives > 0){
      spawnScheduled = true;
      setTimeout(()=>{ if(running && lives>0) spawnWave(); },700);
    }
  }

  function render(){
    const w = canvas.clientWidth;
    const h = canvas.clientHeight;
    ctx.clearRect(0,0,w,h);
    ctx.fillStyle = '#a7f3d0'; ctx.fillRect(0,0,w,h);
    ctx.fillStyle = '#fef3c7'; ctx.fillRect(0,h-60,w,60);
    const diverX = 80; const diverY = h/2; drawDiver(ctx,diverX,diverY);
    for(let s of sharks) drawShark(ctx,s);

    ctx.fillStyle = 'black'; ctx.font = '14px sans-serif';
    ctx.fillText(`Score: ${score}`, w-140,24);
    ctx.fillText(`Lives: ${lives}`, w-140,44);
    ctx.fillText(`Input: ${inputBuffer}`, 12,24);
    ctx.fillText(message, 12,44);

    if(lives <= 0){
      ctx.fillStyle = 'rgba(0,0,0,0.6)'; ctx.fillRect(0,0,w,h);
      ctx.fillStyle = 'white'; ctx.font = '32px sans-serif'; ctx.fillText('Game Over', w/2 - 80, h/2 - 10);
      ctx.font = '18px sans-serif'; ctx.fillText(`Final score: ${score}`, w/2 - 70, h/2 + 20);
    }
  }

  function loop(now){
    const dt = now - last; last = now;
    update(dt); render();
    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);

  // keyboard handling (tetap sama)
  window.addEventListener('keydown', (e)=>{
    if(lives <= 0) return;
    const key = e.key;
    if(!key) return;
    const now = performance.now();
    if(now - lastKeyTime > INPUT_TIMEOUT){ inputBuffer = ''; inputTargetId = null; }
    lastKeyTime = now;

    if(key === 'Backspace'){
      if(!inputTargetId) return;
      const s = sharks.find(sh => sh.id === inputTargetId && !sh.eaten && !sh.dead);
      if(!s){ inputBuffer=''; inputTargetId=null; return; }
      if(s.progress > 0) s.progress = Math.max(0, s.progress - 1);
      inputBuffer = inputBuffer.slice(0,-1);
      if(s.progress === 0) inputTargetId = null;
      updateHUD();
      return;
    }

    if(key.length !== 1) return;
    const lower = key.toLowerCase();

    if(inputTargetId){
      const s = sharks.find(sh => sh.id === inputTargetId && !sh.eaten && !sh.dead);
      if(!s){ inputTargetId = null; inputBuffer = ''; updateHUD(); return; }
      const expected = s.word[s.progress];
      if(lower === expected){
        s.progress += 1; inputBuffer += lower;
        if(s.progress >= s.word.length){
          s.dead = true; score += 10 + Math.floor(20 / Math.max(1, s.word.length)); message = 'Hebat! Hiu hilang karena kata selesai.';
          setTimeout(()=>{ sharks = sharks.filter(x => x !== s); },180);
          inputBuffer = ''; inputTargetId = null; updateHUD();
        } else updateHUD();
      } else {
        message = 'Teks tidak cocok untuk hiu ini. Buffer dibersihkan.'; inputBuffer = ''; inputTargetId = null; updateHUD();
      }
      return;
    }

    const candidates = sharks.filter(sh => !sh.dead && !sh.eaten && sh.word.slice(sh.progress).startsWith(lower));
    if(candidates.length === 0){ message = 'Huruf tidak cocok dengan mana-mana. Coba huruf lain.'; inputBuffer=''; inputTargetId=null; updateHUD(); return; }
    candidates.sort((a,b) => a.x - b.x);
    const s = candidates[0]; s.progress += 1; inputTargetId = s.id; inputBuffer = lower;
    if(s.progress >= s.word.length){ s.dead = true; score += 10 + Math.floor(20 / Math.max(1, s.word.length)); message = 'Hebat! Hiu hilang karena kata selesai.'; setTimeout(()=>{ sharks = sharks.filter(x => x !== s); },180); inputBuffer = ''; inputTargetId = null; }
    updateHUD();
  });

  // buttons
  btnPause.addEventListener('click', ()=>{ running = !running; btnPause.textContent = running ? 'Pause' : 'Resume'; });
  btnRestart.addEventListener('click', ()=>{
    sharks = []; wordsPool = DEFAULT_WORDS.slice(); wave=0; score=0; lives=3; running=true; message='Game dimulai!'; inputBuffer=''; inputTargetId=null; spawnScheduled=false; spawnWave(); updateHUD();
  });

  // initial
  function resetInitial(){ sharks=[]; wordsPool = DEFAULT_WORDS.slice(); wave=0; score=0; lives=3; running=true; message='Ketik kata pada hiu untuk menyelamatkan penyelam!'; inputBuffer=''; inputTargetId=null; spawnScheduled=false; spawnWave(); updateHUD(); }
  resetInitial();
  setTimeout(resizeCanvas, 50);
})();
</script>
</body>
</html>